<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Brawler Counterpick Calculator</title>

<script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>

<style>
    html,body{height:100%;margin:0}
    body{
        display:flex;flex-direction:column;align-items:center;min-height:100vh;overflow-y:auto;
        font-family:'Segoe UI',Roboto,Arial,sans-serif;
        background:#222 url('https://images.unsplash.com/photo-1746118335815-466205f26884?q=80&w=968&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') center/cover no-repeat fixed;
        color:#f8f8f8;text-align:center;padding:2rem 1rem;box-sizing:border-box
    }
    .card{
        background:rgba(0,0,0,.65);
        backdrop-filter:blur(6px);
        border-radius:12px;
        padding:2.5rem 3rem;max-width:720px;width:100%;
        box-shadow:0 0 18px rgba(0,0,0,.45)
    }
    h1{margin-top:0;margin-bottom:1.25rem;text-shadow:0 0 8px rgba(0,0,0,.5)}

    label{display:block;margin:.5rem 0 .25rem;font-weight:600}
    input[type=text]{
        margin-left: -1rem;
        width:100%;padding:.65rem 1rem;font-size:1rem;
        border-radius:8px;border:none;margin-bottom:1rem
    }
    button{
        padding:.8rem 2.25rem;font-size:1.1rem;font-weight:700;
        border:0;border-radius:8px;background:#ffca28;color:#111;cursor:pointer;
        transition:transform .1s ease
    }
    button:hover{transform:scale(1.04)}
    input[type=file]{margin:1.5rem 0 0}

    pre{
        white-space:pre-wrap;background:#111a;padding:1rem 1.5rem;
        border-radius:8px;margin-top:1.75rem;max-height:60vh;overflow:auto
    }
    .footer{margin-top:2rem;font-size:.75rem;opacity:.8}
    .output-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 0.75rem;
      margin-top: 1.75rem;
    }
    .counter-card {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .row{
      text-align:center;
    }
    .output-grid{ 
      justify-content:center; 
    }
    .counter-card img {
      width: 64px; 
      height: 64px;
      object-fit: cover;
      border-radius: 50%;
      margin-bottom: 0.25rem;
      background: #fff;
    }
    .counter-card .name {
      font-size: 0.9rem;
      text-shadow: 0 0 4px rgba(0,0,0,0.6);
    }
    .row {       
    margin-top: 1.25rem;
    }
    #output{
      display:flex;             
      flex-wrap:wrap;            
      justify-content:center;   
      gap:2rem;             
    }
    .row{                       
      flex:1 1 140px;           
      text-align:center;   
    }
    .row .output-grid{
      justify-content:center;
    }
</style>
</head>
<body>
<div class="card">
    <h1>Brawler Counterpick Calculator</h1>

    <label for="b1">Brawler&nbsp;1</label>
    <input id="b1" type="text" list="brawlers" autocomplete="off">

    <label for="b2">Brawler&nbsp;2</label>
    <input id="b2" type="text" list="brawlers" autocomplete="off">

    <label for="b3">Brawler&nbsp;3&nbsp;</label>
    <input id="b3" type="text" list="brawlers" autocomplete="off">

    <datalist id="brawlers"></datalist>

    <button id="go">Go</button>

    <div id="output" class="output-grid"></div>

</div>

<script>
const brawlerNames = [
"8bit","Amber","Angelo","Ash","Barley","Bea","Belle","Berry","Bibi","Bo","Bonnie","Brock",
"Bull","Buster","Buzz","Byron","Carl","Charlie","Chester","Chuck","Clancy","Colette","Colt",
"Cordelius","Crow","Darryl","Doug","Draco","Dynamike","Edgar","El Primo","Emz","Eve","Fang",
"Frank","Gale","Gene","Gray","Griff","Grom","Gus","Hank","Jacky","Janet","Jesse","Juju","Kaze",
"Kenji","Kit","Larry","Leon","Lily","Lola","Lou","Maisie","Mandy","Max","Meple","Meg",
"Melodie","Mico","Moe","Mortis","Mr P","Nani","Nita","Otis","Pam","Pearl","Penny","Piper",
"Poco","RT","Rico","Rosa","Ruffs","Sam","Sandy","Shade","Shelly","Spike","Sprout","Squeak",
"Stu","Surge","Tara","Tick","Willow"
];

document.addEventListener("DOMContentLoaded",()=>{
  const dl = document.getElementById("brawlers");
  brawlerNames.forEach(n=>{const o=document.createElement("option");o.value=n;dl.appendChild(o)});
});
console.log("pursion loaded")
const pyReady = (async ()=>{
  const pyodide = await loadPyodide();
  await pyodide.loadPackage("micropip");
  const resp = await fetch("pycode.py");
  if (!resp.ok) throw new Error("Failed to load python code.")
  const pythonSrc = await resp.text();
  pyodide.runPython(pythonSrc);
  return pyodide;
})();

const outputEl = document.getElementById("output");
async function runCalc(){
  const py = await pyReady;
  const calc = py.globals.get('calculate');
  const raw = calc([
    document.getElementById("b1").value,
    document.getElementById("b2").value,
    document.getElementById("b3").value
  ]);
  console.log("raw from Python:", raw);
  const data = JSON.parse(raw);

  outputEl.innerHTML = "";
  function makeCard(name){
  const card = document.createElement("div");
  card.className = "counter-card";
  const img  = document.createElement("img");
  img.src = `icons/grom.png`;                // keep hard-coded for now
  img.alt = name;
  const span = document.createElement("span");
  span.className = "name";
  span.textContent = name;
  card.append(img, span);
  return card;
}

/* 1) --- each selected brawler and its direct counters --- */
data.results.forEach(group=>{
  const row   = document.createElement("div");   // whole row
  row.className = "row";

  const label = document.createElement("h3");    // “Colt Counters:”
  label.textContent = `${group.brawler} Counters:`;
  row.appendChild(label);

  const grid  = document.createElement("div");   // images grid
  grid.className = "output-grid";
  group.counters.forEach(c=>grid.appendChild(makeCard(c)));

  row.appendChild(grid);
  outputEl.appendChild(row);
});

/* 2) --- overlaps (if any) --- */
function renderOverlap(title, list){
  if(!list.length) return;
  const row   = document.createElement("div");
  row.className = "row";

  const label = document.createElement("h3");
  label.textContent = title;
  row.appendChild(label);

  const grid  = document.createElement("div");
  grid.className = "output-grid";
  list.forEach(n=>grid.appendChild(makeCard(n)));

  row.appendChild(grid);
  outputEl.appendChild(row);
}

renderOverlap("Double Overlaps:", data.doubleOverlaps);
renderOverlap("Triple Overlaps:", data.tripleOverlaps);
}

document.getElementById("go").addEventListener("click",runCalc);
["b1","b2","b3"].forEach(id=>{
  document.getElementById(id).addEventListener("keydown",e=>{
    if(e.key==="Enter"){runCalc()}
  });
});

</script>
</body>
</html>
