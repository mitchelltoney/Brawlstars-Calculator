<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Brawler Counterpick Calculator</title>

<script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>

<style>
    @font-face {
      font-family: 'Brawl Stars';
      src: url('fonts/lilitaone-regular-webfont.ttf') format('truetype');
      font-weight: normal;
    }
    @font-face {
      font-family: 'Brawl Stars Bold';
      src: url('fonts/nougat-extrablack-webfont.ttf') format('truetype');
      font-weight: normal;
    }
    html,body{height:100%;margin:0}
    body{
        display:flex;flex-direction:column;align-items:center;min-height:100vh;overflow-y:auto;
        font-family:'Brawl Stars', sans-serif;
        background:#222 url('background.png') center/cover no-repeat fixed;
        color:#f8f8f8;text-align:center;padding:2rem 1rem;box-sizing:border-box
    }
    .card{
        background:rgba(0,0,0,.65);
        backdrop-filter:blur(6px);
        border-radius:12px;
        padding:2.5rem 3rem;max-width:720px;width:100%;
        box-shadow:0 0 18px rgba(0,0,0,.45)
    }
    h1{margin-top:0;margin-bottom:1.25rem;text-shadow:0 0 8px rgba(0,0,0,.5)}

    label{display:block;margin:.5rem 0 .25rem;font-weight:600}
    input[type=text]{
        margin-left: -1rem;
        width:100%;padding:.65rem 1rem;font-size:1rem;
        border-radius:8px;border:none;margin-bottom:1rem
    }
    button{
        padding:.8rem 2.25rem;font-size:1.1rem;font-weight:700;
        border:0;border-radius:8px;background:#ffca28;color:#111;cursor:pointer;
        transition:transform .1s ease
    }
    button:hover{transform:scale(1.04)}
    input[type=file]{margin:1.5rem 0 0}

    pre{
        white-space:pre-wrap;background:#111a;padding:1rem 1.5rem;
        border-radius:8px;margin-top:1.75rem;max-height:60vh;overflow:auto
    }
    .footer{margin-top:2rem;font-size:.75rem;opacity:.8}
    .output-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 0.75rem;
      margin-top: 1.75rem;
    }
    .counter-card {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .row{
      text-align:center;
    }
    .output-grid{ 
      justify-content:center; 
    }
    .counter-card img {
      width: 64px; 
      height: 64px;
      object-fit: cover;
      border-radius: 50%;
      margin-bottom: 0.25rem;
      background: #fff;
    }
    .subject-icon{
      width:64px;     
      height:64px;
      object-fit:cover;  
      border-radius:6px; 
      background:#fff;
    }
    .counter-card .name {
      font-size: 0.9rem;
      text-shadow: 0 0 4px rgba(0,0,0,0.6);
    }
    .row {       
    margin-top: 1.25rem;
    }
    #output{
      display:block;    
    }
    .row{                    
      display:flex;
      align-items:center;
      gap:1rem;            
      margin-top:0.75rem;
      text-align:left;       
    }
    .row h3{
      margin:0;             
      white-space:normal;
    }
    .row .output-grid{        
      display:flex;           
      flex-wrap:wrap;  
      gap:0.75rem;
    }
</style>
</head>
<body>
<div class="card">
    <p style="margin-top:-0.5rem;font-size:.9rem">
      Want to try the new input interface? <a href="icons.html">Try it here!</a>
    </p>
    <h1>Brawler Counterpick Calculator</h1>

    <label for="b1">Brawler&nbsp;1</label>
    <input id="b1" type="text" list="brawlers" autocomplete="off">

    <label for="b2">Brawler&nbsp;2</label>
    <input id="b2" type="text" list="brawlers" autocomplete="off">

    <label for="b3">Brawler&nbsp;3&nbsp;</label>
    <input id="b3" type="text" list="brawlers" autocomplete="off">

    <datalist id="brawlers"></datalist>

    <button id="go">Go</button>

    <div id="output" class="output-grid"></div>

</div>

<script>
const brawlerNames = [
"8bit","Amber","Angelo","Ash","Barley","Bea","Belle","Berry","Bibi","Bo","Bonnie","Brock",
"Bull","Buster","Buzz","Byron","Carl","Charlie","Chester","Chuck","Clancy","Colette","Colt",
"Cordelius","Crow","Darryl","Doug","Draco","Dynamike","Edgar","El Primo","Emz","Eve","Fang","Finx",
"Frank","Gale","Gene","Gray","Griff","Grom","Gus","Hank","Jacky","Jae Young","Janet","Jessie","Juju","Kaze",
"Kenji","Kit","Larry","Leon","Lily","Lola","Lou","Lumi","Maisie","Mandy","Max","Meeple","Meg",
"Melodie","Mico","Moe","Mortis","Mr P","Nani","Nita","Ollie", "Otis","Pam","Pearl","Penny","Piper",
"Poco","RT","Rico","Rosa","Ruffs","Sam","Sandy","Shade","Shelly","Spike","Sprout","Squeak",
"Stu","Surge","Tara","Tick","Willow"
];

document.addEventListener("DOMContentLoaded",()=>{
  const dl = document.getElementById("brawlers");
  brawlerNames.forEach(n=>{const o=document.createElement("option");o.value=n;dl.appendChild(o)});
});
console.log("pallion3.0 loaded")
const pyReady = (async ()=>{
  const pyodide = await loadPyodide();
  await pyodide.loadPackage("micropip");
  const resp = await fetch("pycode.py");
  if (!resp.ok) throw new Error("Failed to load python code.")
  const pythonSrc = await resp.text();
  pyodide.runPython(pythonSrc);
  return pyodide;
})();

const outputEl = document.getElementById("output");
async function runCalc(){
  const py = await pyReady;
  const calc = py.globals.get('calculate');
  const raw = calc([
    document.getElementById("b1").value,
    document.getElementById("b2").value,
    document.getElementById("b3").value
  ]);
  console.log("raw from Python:", raw);
  const data = JSON.parse(raw);

  outputEl.innerHTML = "";
  function makeCard(name){
  const card = document.createElement("div");
  card.className = "counter-card";
  const img  = document.createElement("img");
  const filename = name
        .toLowerCase()          // grom → grom, Mr P → mr p, El Primo → el primo
        .replace(/[\s.']/g, "_")
        + ".png"; 
  img.src = `icons/${filename}`;
  img.alt = name;
  const span = document.createElement("span");
  span.className = "name";
  span.textContent = name;
  card.append(img, span);
  return card;
}

/* 1) --- each selected brawler and its direct counters --- */
data.results.forEach(group=>{
  const row   = document.createElement("div");
  row.className = "row";

  const subjectImg = document.createElement("img");
  subjectImg.className = "subject-icon"
  subjectImg.src = `icons/${group.brawler
                    .toLowerCase()
                    .replace(/[\s.']/g,"_")}.png`;
  row.appendChild(subjectImg);        
  subjectImg.alt = group.brawler;

  // “Colt Counters:”
  const label = document.createElement("h3");    
  label.innerHTML = `${group.brawler}<br>Counters :`;
  row.appendChild(label);

  const grid  = document.createElement("div");   // images grid
  grid.className = "output-grid";
  group.counters.forEach(c=>grid.appendChild(makeCard(c)));

  row.appendChild(grid);
  outputEl.appendChild(row);
});

/* 2) --- overlaps (if any) --- */
function renderOverlap(title, list){
  if(!list.length) return;
  const row   = document.createElement("div");
  row.className = "row";

  const label = document.createElement("h3");
  label.innerHTML = title.replace(" ", "<br>");
  row.appendChild(label);

  const grid  = document.createElement("div");
  grid.className = "output-grid";
  list.forEach(n=>grid.appendChild(makeCard(n)));

  row.appendChild(grid);
  outputEl.appendChild(row);
}

renderOverlap("Double Overlaps:", data.doubleOverlaps);
renderOverlap("Triple Overlaps:", data.tripleOverlaps);
}

document.getElementById("go").addEventListener("click",runCalc);
["b1","b2","b3"].forEach(id=>{
  document.getElementById(id).addEventListener("keydown",e=>{
    if(e.key==="Enter"){runCalc()}
  });
});

</script>
</body>
</html>
