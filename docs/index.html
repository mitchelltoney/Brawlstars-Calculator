<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Brawler Counterpick Calculator â€“ Icon Picker</title>

<!-- Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>

<style>
@font-face {
      font-family: 'Brawl Stars';
      src: url('fonts/lilitaone-regular-webfont.ttf') format('truetype');
      font-weight: normal;
}
@font-face {
    font-family: 'Brawl Stars Bold';
    src: url('fonts/nougat-extrablack-webfont.ttf') format('truetype');
    font-weight: normal;
}
html,body{height:100%;margin:0}
body{
    display:flex;flex-direction:column;align-items:center;min-height:100vh;overflow-y:auto;
    font-family:'Brawl Stars', sans-serif;
    background:#222 url('background.png') center/cover no-repeat fixed;
    color:#f8f8f8;text-align:center;padding:2rem 1rem;box-sizing:border-box
}
.card{
    background:rgba(0,0,0,.65);
    backdrop-filter:blur(6px);
    border-radius:12px;
    padding:2.5rem 3rem;max-width:720px;width:100%;
    box-shadow:0 0 18px rgba(0,0,0,.45)
}
h1{margin-top:0;margin-bottom:1.25rem;text-shadow:0 0 8px rgba(0,0,0,.5)}

label{display:block;margin:.5rem 0 .25rem;font-weight:600}
input[type=text]{
    margin-left: -1rem;
    width:100%;padding:.65rem 1rem;font-size:1rem;
    border-radius:8px;border:none;margin-bottom:1rem
}
button{
    padding:.8rem 2.25rem;font-size:1.1rem;font-weight:700;
    border:0;border-radius:8px;background:#ffca28;color:#111;cursor:pointer;
}
button:hover{transform:scale(1.04)}
input[type=file]{margin:1.5rem 0 0}

pre{
    white-space:pre-wrap;background:#111a;padding:1rem 1.5rem;
    border-radius:8px;margin-top:1.75rem;max-height:60vh;overflow:auto
}
.footer{margin-top:2rem;font-size:.75rem;opacity:.8}
.output-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 0.75rem;
    margin-top: 1.75rem;
}
.counter-card {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.row{
    text-align:center;
}
.output-grid{ 
    justify-content:center; 
}
.counter-card img {
    width: 64px; 
    height: 64px;
    object-fit: cover;
    border-radius: 50%;
    margin-bottom: 0.25rem;
    background: #fff;
}
.subject-icon{
    width:64px;     
    height:64px;
    object-fit:cover;  
    border-radius:6px; 
    background:#fff;
}
.counter-card .name {
    font-size: 0.9rem;
    text-shadow: 0 0 4px rgba(0,0,0,0.6);
}
.row {       
margin-top: 1.25rem;
}
#output{
    display:block;    
}
.row{                    
    display:flex;
    align-items:center;
    gap:1rem;            
    margin-top:0.75rem;
    text-align:left;       
}
.row h3{
    margin:0;             
    white-space:normal;
}
.row .output-grid{        
    display:flex;           
    flex-wrap:wrap;  
    gap:0.75rem;
}
/* extra rules only needed here */
.icon-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,64px);
  justify-content:center;
  gap:0.65rem;
  max-width:720px;
  margin:0 auto 1.75rem;
}
.icon-grid img{
  width:60px;height:60px;object-fit:cover;
  border-radius:6px;background:#fff;cursor:pointer;
}
.icon-grid img:hover{transform:scale(1.08)}
.icon-grid img.selected{
  outline:3px solid #ffca28;
  transform:scale(1.08);
}
</style>
</head>
<body>
<div class="card">
  <h1>Brawler Counterpick Calculator</h1>
  <p style="margin-top:-0.5rem;font-size:.9rem">
    Prefer typing? <a href="texts.html">Switch to text inputs</a>
  </p>

  <h2 style="margin:1rem 0 0.5rem">Pick up to three brawlers</h2>
  <div id="iconGrid" class="icon-grid"></div>

  <button id="go" style="margin-top:0.5rem">Go</button>

  <div id="output" class="output-grid"></div>
</div>

<script>
/* ----------  same master list  ---------- */
const brawlerNames = [
"8bit","Amber","Angelo","Ash","Barley","Bea","Belle","Berry","Bibi","Bo","Bonnie","Brock",
"Bull","Buster","Buzz","Byron","Carl","Charlie","Chester","Chuck","Clancy","Colette","Colt",
"Cordelius","Crow","Darryl","Doug","Draco","Dynamike","Edgar","El Primo","Emz","Eve","Fang","Finx",
"Frank","Gale","Gene","Gray","Griff","Grom","Gus","Hank","Jacky","Jae Young","Janet","Jessie","Juju","Kaze",
"Kenji","Kit","Larry","Leon","Lily","Lola","Lou","Lumi","Maisie","Mandy","Max","Meeple","Meg",
"Melodie","Mico","Moe","Mortis","Mr P","Nani","Nita","Ollie", "Otis","Pam","Pearl","Penny","Piper",
"Poco","RT","Rico","Rosa","Ruffs","Sam","Sandy","Shade","Shelly","Spike","Sprout","Squeak",
"Stu","Surge","Tara","Tick","Willow"
];
console.log("gallion5.0 loaded")
/* ----------  load Pyodide and python ---------- */
const pyReady=(async()=>{
  const pyodide=await loadPyodide();
  await pyodide.loadPackage("micropip");
  const src=await (await fetch("pycode.py")).text();
  pyodide.runPython(src);
  return pyodide;
})();

/* ----------  build the icon grid  ---------- */
const grid=document.getElementById("iconGrid");
const picks=new Set();

function fileName(n){
  return n.toLowerCase().replace(/[\s.']/g,"_")+".png";
}
brawlerNames.forEach(n=>{
  const img=document.createElement("img");
  img.src=`icons/${fileName(n)}`;
  img.alt=img.title=n;
  img.dataset.name=n;
  grid.appendChild(img);
});

grid.addEventListener("click",e=>{
  const img=e.target.closest("img");
  if(!img) return;
  const name=img.dataset.name;

  if(img.classList.contains("selected")){
    img.classList.remove("selected");
    picks.delete(name);
  }else{
    if(picks.size===3){alert("Only three brawlers please");return;}
    img.classList.add("selected");
    picks.add(name);
  }
});

/* ----------  calculation & output  ---------- */
const outputEl=document.getElementById("output");

function makeCard(name){
  const card=document.createElement("div");
  card.className="counter-card";
  const img=document.createElement("img");
  img.src=`icons/${fileName(name)}`;
  img.alt=name;
  const span=document.createElement("span");
  span.className="name";span.textContent=name;
  card.append(img,span);
  return card;
}

async function runCalc(){
  if(!picks.size){alert("Select at least one brawler");return;}
  const py=await pyReady;
  const calc=py.globals.get("calculate");

  /* pad with empty strings */
  const arr=[...picks];
  const raw=calc([arr[0]||"",arr[1]||"",arr[2]||""]);
  const data=JSON.parse(raw);

  outputEl.innerHTML="";
  data.results.forEach(group=>{
    const row=document.createElement("div");row.className="row";
    const sImg=document.createElement("img");
    sImg.className="subject-icon";
    sImg.src=`icons/${fileName(group.brawler)}`;
    sImg.alt=group.brawler;
    row.appendChild(sImg);

    const label=document.createElement("h3");
    label.innerHTML=`${group.brawler}<br>Counters :`;
    row.appendChild(label);

    const grid=document.createElement("div");
    grid.className="output-grid";
    group.counters.forEach(c=>grid.appendChild(makeCard(c)));
    row.appendChild(grid);
    outputEl.appendChild(row);
  });

  function renderOverlap(title,list){
    if(!list.length) return;
    const row=document.createElement("div");row.className="row";
    const label=document.createElement("h3");
    label.innerHTML=title.replace(" ","<br>");
    row.appendChild(label);
    const g=document.createElement("div");g.className="output-grid";
    list.forEach(n=>g.appendChild(makeCard(n)));
    row.appendChild(g);
    outputEl.appendChild(row);
  }
  renderOverlap("Double Overlaps:",data.doubleOverlaps);
  renderOverlap("Triple Overlaps:",data.tripleOverlaps);
}

document.getElementById("go").addEventListener("click",runCalc);
</script>
</body>
</html>
